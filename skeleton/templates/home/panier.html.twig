<!doctype html>
<html class="no-js" lang="fr">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Perfect Dog Store - Panier</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="{{ asset('assets/img/logo/erasebg-transformed.png') }}">

    <!-- all css here -->
    <link rel="stylesheet" href="{{ asset('assets/css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/css/animate.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/css/simple-line-icons.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/css/themify-icons.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/css/owl.carousel.min.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/css/meanmenu.min.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/css/style.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/css/responsive.css') }}">
    <script src="{{ asset('assets/js/vendor/modernizr-3.11.7.min.js') }}"></script>
</head>
<body>

<header class="header-area">
    <div class="header-top theme-bg">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 col-md-4 col-12">
                    <div class="welcome-area">
                        <p>Bienvenue sur perfect-dog-store</p>
                    </div>
                </div>
                <div class="col-lg-8 col-md-8 col-12">
                    <div class="account-curr-lang-wrap f-right">
                        <ul>
                            <li><a href="#"><img alt="flag" src="{{ asset('assets/img/icon-img/fr.jpg') }}"> Français</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="header-bottom transparent-bar">
        <div class="container">
            <div class="row">
                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-4 col-5">
                    <div class="logo pt-39">
                        <a href="{{ path('app_home') }}"><img alt="logo" src="{{ asset('assets/img/logo/erasebg-transformed.png') }}" height="60"></a>
                    </div>
                </div>
                <div class="col-xl-8 col-lg-7 d-none d-lg-block relative">
                    <div class="main-menu text-center">
                        <nav>
                            <ul>
                                <li><a href="{{ path('app_home') }}">Accueil</a></li>
                                <li><a href="{{ path('app_shop_details') }}">Nourriture</a></li>
                                <li><a href="#">Accessoires</a></li>
                                <li><a href="{{ path('app_about') }}">À propos</a></li>
                                <li><a href="{{ path('app_contact') }}">Contactez-nous</a></li>
                            </ul>
                        </nav>
                    </div>
                </div>
                <div class="col-xl-2 col-lg-2 col-md-8 col-sm-8 col-7 relative">
                    <div class="search-login-cart-wrapper">
                        <div class="header-login same-style">
                            {% if app.user %}
                                <a href="{{ path('app_account') }}"><i class="icon-user icons"></i></a>
                            {% else %}
                                <a href="{{ path('app_login') }}"><i class="icon-user icons"></i></a>
                            {% endif %}
                        </div>
                        <div class="header-cart same-style">
                            <button class="icon-cart">
                                <i class="icon-handbag"></i>
                                <span class="count-style">
                                    {{ panier.entity and panier.entity.produits|length > 0 ? panier.entity.produits|length : 0 }}
                                </span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<div class="breadcrumb-area pt-95 pb-95 bg-img" style="background-image:url({{ asset('assets/img/banner/banner-shop_1.png') }});">
    <div class="container">
        <div class="breadcrumb-content text-center">
            <h2>Panier</h2>
        </div>
    </div>
</div>

<!-- shopping-cart-area start -->

<div class="cart-main-area pt-95 pb-100">
    <div class="container">
        <h3 class="page-title">Vos articles sélectionnés</h3>
        <div class="row">
            <div class="col-lg-12">
                <div class="table-content table-responsive">
                    <table>
                        <thead>
                        <tr>
                            <th>Image</th>
                            <th>Produit</th>
                            <th>Prix unitaire</th>
                            <th>Quantité</th>
                            <th>Prix total</th>
                            <th>Supprimer</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% if panier.entity and panier.entity.produits|length > 0 %}
                            {% for panierProduit in panier.entity.produits %}
                                <tr>
                                    <td class="product-thumbnail">
                                        <a href="#">
                                            <img src="{{ asset(panierProduit.produit.thumbnail) }}" height="120" alt="{{ panierProduit.produit.name }}">
                                        </a>
                                    </td>
                                    <td class="product-name">{{ panierProduit.produit.name }}</td>
                                    <td class="product-price-cart">{{ panierProduit.produit.prix }} €</td>
                                    <td class="product-quantity">
                                    <div class="cart-plus-minus">
                                        <input class="cart-plus-minus-box"
                                            type="text"
                                            name="qtybutton"
                                            value="{{ panierProduit.quantite }}"
                                            data-id="{{ panierProduit.id }}"> 
                                    </div>
                                    </td>
                                    <td class="product-subtotal">
                                    {{ panierProduit.produit.prix * panierProduit.quantite }} €
                                    </td>
                                    <td class="product-remove">
                                        <a href="{{ path('app_panier_remove', {id: panierProduit.id}) }}"><i class="ti-trash"></i></a>
                                    </td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="6" class="text-center">Votre panier est vide</td>
                            </tr>
                        {% endif %}
                        </tbody>
                    </table>
                </div>

                <!-- Totaux -->
                {% set total = 0 %}
                {% if panier.entity %}
                    {% for panierProduit in panier.entity.produits %}
                        {% set total = total + (panierProduit.quantite * panierProduit.produit.prix) %}
                    {% endfor %}
                {% endif %}

                <div class="grand-totall mt-4">
    <h4>Total produits : <span>{{ total }} €</span></h4>
<!-- Adresse de livraison -->
<div class="checkout-form mt-3">
    <h5>Adresse de livraison</h5>
    <form id="address-form">
        <div class="row">
            <div class="col-md-6">
                <input type="text" name="prenom" placeholder="Prénom" class="form-control mb-2" required>
            </div>
            <div class="col-md-6">
                <input type="text" name="nom" placeholder="Nom" class="form-control mb-2" required>
            </div>
            <div class="col-md-12">
                <input type="text" name="rue" placeholder="Rue et numéro" class="form-control mb-2" required>
            </div>
            <div class="col-md-6">
                <input type="text" name="ville" placeholder="Ville" class="form-control mb-2" required>
            </div>
            <div class="col-md-3">
                <input type="text" name="code_postal" placeholder="Code postal" class="form-control mb-2" required>
            </div>
            <div class="col-md-3">
                <input type="text" name="pays" value="France" class="form-control mb-2" required>
            </div>
        </div>
        <button type="button" id="validate-address" class="btn btn-secondary mt-3">
            Valider l’adresse
        </button>
    </form>
</div>

<!-- Choix de livraison (rempli dynamiquement) -->
<div class="mt-4" id="delivery-options" style="display:none;">
    <h5>Choisissez votre mode de livraison</h5>
    <form id="delivery-form"></form>
</div>

<!-- Totaux -->
<h5 class="mt-3">
    Grand Total (avec livraison) :
    <span id="grand-total">{{ total }} €</span>
</h5>

<!-- Bouton paiement -->
<a href="{{ path('app_shop_payment') }}"
   id="validate-cart"
   class="btn btn-primary d-block mt-3"
   style="display:none; visibility:hidden;">
    Procéder au paiement
</a>

<!-- shopping-cart-area end -->
<footer class="footer-area">
    <div class="footer-bottom gray-bg-3 pt-17 pb-15">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="copyright text-center">
                        <p>Copyright © <a href="#">perfect-dog-store</a> Tous droits réservés.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- all js here -->
<script src="{{ asset('assets/js/vendor/jquery-v1.12.4.min.js') }}"></script>
<script src="{{ asset('assets/js/bootstrap.min.js') }}"></script>
<script src="{{ asset('assets/js/owl.carousel.min.js') }}"></script>
<script src="{{ asset('assets/js/plugins.js') }}"></script>
<script src="{{ asset('assets/js/main.js') }}"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const baseTotal = {{ total }};
    const deliveryOptionsDiv = document.getElementById('delivery-options');
    const deliveryForm = document.getElementById('delivery-form');
    const grandTotalSpan = document.getElementById('grand-total');
    const validateCartBtn = document.getElementById('validate-cart');

    // Quand on valide l’adresse
    document.getElementById('validate-address').addEventListener('click', function () {
        const formData = new FormData(document.getElementById('address-form'));
        let valid = true;

        formData.forEach(value => { if (!value) valid = false; });

        if (!valid) {
            alert("Veuillez remplir tous les champs de l’adresse.");
            return;
        }

        // Simuler appel à UPS API (mock pour le moment)
        const options = [
            { code: "UPS_STANDARD", description: "UPS Standard (3-5 jours)", price: 8 },
            { code: "UPS_EXPRESS", description: "UPS Express (1-2 jours)", price: 15 }
        ];

        // Remplir dynamiquement les options
        deliveryForm.innerHTML = "";
        options.forEach(option => {
            const div = document.createElement("div");
            div.classList.add("form-check", "mb-2");
            div.innerHTML = `
                <input class="form-check-input delivery-choice"
                       type="radio"
                       name="delivery"
                       id="delivery_${option.code}"
                       value="${option.price}"
                       data-code="${option.code}">
                <label class="form-check-label" for="delivery_${option.code}">
                    ${option.description} – ${option.price} €
                </label>
            `;
            deliveryForm.appendChild(div);
        });

        deliveryOptionsDiv.style.display = "block";

        // Gestion choix livraison
        document.querySelectorAll('.delivery-choice').forEach(choice => {
            choice.addEventListener('change', function () {
                const deliveryPrice = parseFloat(this.value);
                grandTotalSpan.textContent = (baseTotal + deliveryPrice) + " €";

                // Affiche le bouton une fois la livraison choisie
                validateCartBtn.style.display = "block";
                validateCartBtn.style.visibility = "visible";
            });
        });
    });
});
</script>



</body>
</html>
